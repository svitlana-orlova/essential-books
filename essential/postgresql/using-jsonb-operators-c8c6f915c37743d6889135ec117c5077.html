<!doctype html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../../assets/main.css" rel="stylesheet">
</head>
<body class="page">
<header class="page__header">
    <div class="page__header__left">
        <a id="link-home" href="../../index.html">
            &nbsp;Essential Books</a>
    </div>
</header>
<div class="content">
    <div class="article">
      

<div style="display: flex; justify-content: space-between">
  <h1 class="title">Using JSONb operators</h1>
  <a class="edit-link" style="font-size: 80%" href="https://notion.so/c8c6f915c37743d6889135ec117c5077" rel="nofollow" target="_blank">suggest change</a>
</div>


      
  <h1 id="87fb2908-2025-40d3-83c0-823ac8084f9a" class="">Creating a DB and a Table
  <a class="header-anchor" href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#87fb2908-2025-40d3-83c0-823ac8084f9a" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>

<div class="code-box lang-SQL">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="k">DROP</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">books_db</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">books_db</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">ENCODING</span><span class="o">=</span><span class="s1">'UTF8'</span><span class="w"> </span><span class="k">TEMPLATE</span><span class="w"> </span><span class="n">template0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">books</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">client</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">data</span><span class="w"> </span><span class="n">JSONb</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
  <h1 id="fe0afde6-1e04-4a78-900b-fe04d42aea50" class="">Populating the DB
  <a class="header-anchor" href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#fe0afde6-1e04-4a78-900b-fe04d42aea50" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>

<div class="code-box lang-SQL">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">books</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">'Joe'</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">'{ "title": "Siddhartha", "author": { "first_name": "Herman", "last_name": "Hesse" } }'</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">'Jenny'</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">'{ "title": "Dharma Bums", "author": { "first_name": "Jack", "last_name": "Kerouac" } }'</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">'Jenny'</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">'{ "title": "100 años de soledad", "author": { "first_name": "Gabo", "last_name": "Marquéz" } }'</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Lets see everything inside the table books:
</p>

<div class="code-box lang-SQL">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="p">;</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/6d5bdd0a9a20d658288c76cd531b7b68bf9acf5e.png">
  <h1 id="97f5b21f-08bb-4212-91fd-0fd432e45958" class=""><code>-&gt;</code> operator returns values out of JSON columns
  <a class="header-anchor" href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#97f5b21f-08bb-4212-91fd-0fd432e45958" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Selecting 1 column:
</p>

<div class="code-box lang-SQL">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">data</span><span class="o">-&gt;</span><span class="s1">'title'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">title</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="p">;</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/999f237b27edb805880193011c9efea62de6a37d.png">
<p>enter image description here
</p>
<p>Selecting 2 columns:
</p>

<div class="code-box lang-SQL">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">data</span><span class="o">-&gt;</span><span class="s1">'title'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="o">-&gt;</span><span class="s1">'author'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="p">;</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/cdb063bacb69feca8b0d81dcbbb735beb4dee5b3.png">
<p>enter image description here
</p>
  <h1 id="7180cbd9-652b-4c0c-a192-93ce8c12d5f9" class=""><code>-&gt;</code> vs <code>-&gt;&gt;</code>
  <a class="header-anchor" href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#7180cbd9-652b-4c0c-a192-93ce8c12d5f9" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>The <code>-&gt;</code> operator returns the original JSON type (which might be an object), whereas <code>-&gt;&gt;</code> returns text.
</p>
  <h1 id="d7e5162c-39d8-43bc-ae88-c0c12f9d6407" class="">Return NESTED objects
  <a class="header-anchor" href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#d7e5162c-39d8-43bc-ae88-c0c12f9d6407" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>You can use the <code>-&gt;</code> to return a nested object and thus chain the operators:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">SELECT client, 
</span></span><span class="line"><span class="cl">   data-&gt;'author'-&gt;'last_name' AS author
</span></span><span class="line"><span class="cl">   FROM books;</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/82f39028df6ca8f8c9e7c8cb9277574edab90270.png">
<p>enter image description here
</p>
  <h1 id="f514620c-b6c7-46c8-b13a-7b9a607e1d30" class="">Filtering
  <a class="header-anchor" href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#f514620c-b6c7-46c8-b13a-7b9a607e1d30" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Select rows based on a value inside your JSON:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">SELECT 
</span></span><span class="line"><span class="cl">client,
</span></span><span class="line"><span class="cl">data-&gt;'title' AS title
</span></span><span class="line"><span class="cl">FROM books
</span></span><span class="line"><span class="cl"> WHERE data-&gt;'title' = '"Dharma Bums"';</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Notice WHERE uses <code>-&gt;</code> so we must compare to JSON <code>'"Dharma Bums"'</code>
</p>
<p>Or we could use <code>-&gt;&gt;</code> and compare to <code>'Dharma Bums'</code>
</p>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/8a4f72eb449fca40b86f914de3b57666a32f7f73.png">
<p>enter image description here
</p>
  <h1 id="20dc2844-cb4e-41eb-97fa-60944e1e6a92" class="">Nested filtering
  <a class="header-anchor" href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#20dc2844-cb4e-41eb-97fa-60944e1e6a92" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Find rows based on the value of a nested JSON object:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">SELECT 
</span></span><span class="line"><span class="cl"> client,
</span></span><span class="line"><span class="cl"> data-&gt;'title' AS title
</span></span><span class="line"><span class="cl"> FROM books
</span></span><span class="line"><span class="cl">  WHERE data-&gt;'author'-&gt;&gt;'last_name' = 'Kerouac';</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/46f30447b3942ba73a96d1ed5a97d0aeabdd2562.png">
<p>enter image description here
</p>
  <h1 id="37efb224-d34b-4a63-9f56-10bf6e49028e" class="">A real world example
  <a class="header-anchor" href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#37efb224-d34b-4a63-9f56-10bf6e49028e" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">CREATE TABLE events (
</span></span><span class="line"><span class="cl">  name varchar(200),
</span></span><span class="line"><span class="cl">  visitor_id varchar(200),
</span></span><span class="line"><span class="cl">  properties json,
</span></span><span class="line"><span class="cl">  browser json
</span></span><span class="line"><span class="cl">);</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>We’re going to store events in this table, like pageviews. Each event has properties, which could be anything (e.g. current page) and also sends information about the browser (like OS, screen resolution, etc). Both of these are completely free form and could change over time (as we think of extra stuff to track).
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">INSERT INTO events (name, visitor_id, properties, browser) VALUES
</span></span><span class="line"><span class="cl">(
</span></span><span class="line"><span class="cl">  'pageview', '1',
</span></span><span class="line"><span class="cl">  '{ "page": "/" }',
</span></span><span class="line"><span class="cl">  '{ "name": "Chrome", "os": "Mac", "resolution": { "x": 1440, "y": 900 } }'
</span></span><span class="line"><span class="cl">),(
</span></span><span class="line"><span class="cl">  'pageview', '2',
</span></span><span class="line"><span class="cl">  '{ "page": "/" }',
</span></span><span class="line"><span class="cl">  '{ "name": "Firefox", "os": "Windows", "resolution": { "x": 1920, "y": 1200 } }'
</span></span><span class="line"><span class="cl">),(
</span></span><span class="line"><span class="cl">  'pageview', '1',
</span></span><span class="line"><span class="cl">  '{ "page": "/account" }',
</span></span><span class="line"><span class="cl">  '{ "name": "Chrome", "os": "Mac", "resolution": { "x": 1440, "y": 900 } }'
</span></span><span class="line"><span class="cl">),(
</span></span><span class="line"><span class="cl">  'purchase', '5',
</span></span><span class="line"><span class="cl">  '{ "amount": 10 }',
</span></span><span class="line"><span class="cl">  '{ "name": "Firefox", "os": "Windows", "resolution": { "x": 1024, "y": 768 } }'
</span></span><span class="line"><span class="cl">),(
</span></span><span class="line"><span class="cl">  'purchase', '15',
</span></span><span class="line"><span class="cl">  '{ "amount": 200 }',
</span></span><span class="line"><span class="cl">  '{ "name": "Firefox", "os": "Windows", "resolution": { "x": 1280, "y": 800 } }'
</span></span><span class="line"><span class="cl">),(
</span></span><span class="line"><span class="cl">  'purchase', '15',
</span></span><span class="line"><span class="cl">  '{ "amount": 500 }',
</span></span><span class="line"><span class="cl">  '{ "name": "Firefox", "os": "Windows", "resolution": { "x": 1280, "y": 800 } }'
</span></span><span class="line"><span class="cl">);</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Now lets select everything:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">SELECT * FROM events;</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/b4c671cd4fba3a6a152bec7094a051890e99f7ba.png">
<p>enter image description here
</p>
  <h1 id="8f686a82-6395-4fb2-83c3-5e8356604f13" class="">JSON operators + PostgreSQL aggregate functions
  <a class="header-anchor" href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#8f686a82-6395-4fb2-83c3-5e8356604f13" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Using the JSON operators, combined with traditional PostgreSQL aggregate functions, we can pull out whatever we want. You have the full might of an RDBMS at your disposal.
</p>
  <ul id="31fc3df2-c856-4eb5-a16f-bde9782ac6a5" class="bulleted-list">
    <li>Lets see browser usage:
    </li>
  </ul>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">SELECT browser-&gt;&gt;'name' AS browser, 
</span></span><span class="line"><span class="cl">  count(browser)
</span></span><span class="line"><span class="cl">  FROM events
</span></span><span class="line"><span class="cl">  GROUP BY browser-&gt;&gt;'name';</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/a8e331aff075354ad70ddfd47d547133bdc39ad9.png">
<p>enter image description here
</p>
  <ul id="e76039d6-8267-4633-bf1a-700e9134e2f5" class="bulleted-list">
    <li>Total revenue per visitor:
    </li>
  </ul>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">SELECT visitor_id, SUM(CAST(properties-&gt;&gt;'amount' AS integer)) AS total
</span></span><span class="line"><span class="cl">    FROM events
</span></span><span class="line"><span class="cl">    WHERE CAST(properties-&gt;&gt;'amount' AS integer) &gt; 0
</span></span><span class="line"><span class="cl">    GROUP BY visitor_id;</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/8b68a6d4bdd64cdad4c502a237b277934dee4ce8.png">
<p>enter image description here
</p>
  <ul id="1384f714-5408-49b1-966e-fa15519d26be" class="bulleted-list">
    <li>Average screen resolution
    </li>
  </ul>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">SELECT AVG(CAST(browser-&gt;'resolution'-&gt;&gt;'x' AS integer)) AS width,
</span></span><span class="line"><span class="cl">  AVG(CAST(browser-&gt;'resolution'-&gt;&gt;'y' AS integer)) AS height
</span></span><span class="line"><span class="cl">FROM events;</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Output:
</p>
<img class="img" src="http://localhost:8000/essential/postgresql/img/c1e93c91e8808aeac1884817ec980cc341d52d5e.png">
<p>enter image description here
</p>
<p>More examples and documentation <a href="http://schinckel.net/2014/05/25/querying-json-in-postgres/">here</a> and <a href="http://clarkdave.net/2013/06/what-can-you-do-with-postgresql-and-json/">here</a>.
</p>

      <div class="forum-link">
  Found a mistake? Have a question or improvement idea?
  <a href="using-jsonb-operators-c8c6f915c37743d6889135ec117c5077.html#" onclick="showContact(); return false;">Let me know</a>.
</div>

      <form id="contact-form" action="https://formsubmit.co/kkowalczyk@gmail.com" method="POST">
  <p>
    </p><div class="contact-light">Feedback about page:</div>
    <input type="text" name="page-url" id="contact-page-url" readonly>
  

  <p>
    </p><div class="contact-light">Feedback:</div>
    <textarea name="message" id="msg-for-chris"></textarea>
    <div class="contact-light">Optional: your email if you want me to get back to you: </div>
    <input type="email" name="email">
    <input type="hidden" name="_template" value="box">
    <input type="text" name="_honey" class="noshow">
  

  <p>
    <button type="submit" class="contact-btn">
      Send Feedback
    </button>

    <button class="contact-btn" style="float: right;" onclick="hideContact(); return false;">
      Cancel
    </button>
  </p>
</form>


      <hr class="article-bottom-sep">
    </div>

    <div id="page-toc"><div class="article chapter-toc svelte-1t851gm"><div class="mtoc-0 svelte-1t851gm"><b>JSON Support:</b></div><div class="mtoc-1 svelte-1t851gm"><span class="no svelte-1ib47n1">*</span><a href="json-support-4d874cbed15940b387e14594f505987f.html">JSON Support</a></div><div class="mtoc-1 svelte-1t851gm"><span class="no svelte-1ib47n1">*</span><b>Using JSONb operators</b></div><div class="mtoc-1 svelte-1t851gm"><span class="no svelte-1ib47n1">*</span><a href="querying-complex-json-documents-63372ab3b6f74f91991d29f00074b06f.html">Querying complex JSON documents</a></div><div class="mtoc-1 svelte-1t851gm"><span class="no svelte-1ib47n1">*</span><a href="creating-a-pure-json-table-4b095d2c32424e30a5181b1bf401fa07.html">Creating a pure JSON table</a></div></div></div>

    <div id="chapter-toc-wrapper">
      <hr>
      <div class="hdr">Table Of Contents</div>
      <div id="book-toc"><div class="article toc svelte-1ib47n1"><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">0</span><a href="getting-started-b656c2d9b7f041f99104f7870c3bd3c9.html">Getting Started</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">1</span><b>JSON Support</b></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">2</span><a href="role-management-5d4907832722485aa0f85c47511443f9.html">Role Management</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">3</span><a href="common-table-expressions-with-681a2c9efae74f189f80461c4c09c58a.html">Common Table Expressions WITH</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">4</span><a href="accessing-data-programatically-f25f5b0103a74c7d8e939426f864b292.html">Accessing Data Programatically</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">5</span><a href="backup-and-restore-6feaa1fce2a74554bc6cfd6fa87755f4.html">Backup and Restore</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">6</span><a href="table-creation-75f908151ace407381442933da6164c1.html">Table Creation</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">7</span><a href="insert-1b89e5745d0d4bdfab44b5312db9e0c9.html">INSERT</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">8</span><a href="update-0af4c7d78383485db40cd8742d4614ed.html">UPDATE</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">9</span><a href="dates-timestamps-and-intervals-c7bb4b02c1894ac9874a3063a6e701e9.html">Dates, Timestamps and Intervals</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">10</span><a href="aggregate-functions-0ceb6cef14f04b099f879e98af207550.html">Aggregate Functions</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">11</span><a href="programming-with-plpgsql-0c02c8f26e29480e9bb2cdeb1f224d96.html">Programming with PLPGSQL</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">12</span><a href="inheritance-c0eaf930378b47c0895c8a7b1ce51777.html">Inheritance</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">13</span><a href="high-availability-5d2d39b0a2fc4e769b2070d4267b34cc.html">High Availability</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">14</span><a href="triggers-and-trigger-functions-584f9f2e7a4f4f378080eb3de3eaf6d2.html">Triggers and Trigger Functions</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">15</span><a href="extension-dblink-and-postgres-fdw-1a613c3811be4622879f261a3852b802.html">EXTENSION dblink and postgres fdw</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">16</span><a href="window-functions-66100120d0d24226ab23554ee203d7db.html">Window Functions</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">17</span><a href="postgres-tips-and-tricks-ba264bb2630a4be6beb77d92d929a0ce.html">Postgres Tips and Tricks</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">18</span><a href="backup-script-for-a-production-db-5b31d6d9d8d344d785daedb02d8e7383.html">Backup script for a production DB</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">19</span><a href="comments-58746f677c4643f09125b5f23fcaace0.html">Comments</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">20</span><a href="export-to-csv-a31bb49fd2df4eec90a6864c51111958.html">Export to csv</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">21</span><a href="data-types-ae4c97208297442fbe50b7c9b974351b.html">Data Types</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">22</span><a href="recursive-queries-b6b11111255f4c388f25a412bc108e55.html">Recursive queries</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">23</span><a href="postgres-cryptographic-functions-468130e5ec364d5f995c0763643830c0.html">Postgres cryptographic functions</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">24</span><a href="event-triggers-502c5a791bd9465786c027fcaa48a9e0.html">Event Triggers</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">25</span><a href="select-5ec4fe9320664e62b48b247fa2451cf9.html">SELECT</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">26</span><a href="connect-from-java-ed4d52f8abc34faebd5e08974843aa30.html">Connect from Java</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">27</span><a href="find-string-length-b2abeec84aaa476999b6e9ab17e6ddda.html">Find String Length</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">28</span><a href="coalesce-2a19f9bae6844155becb0d4da3888f1c.html">COALESCE</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">29</span><a href="contributors-17c104490ab54f59b03c3db31a4b0d10.html">Contributors</a></div></div></div></div>
    </div>
  </div></body>
</html>