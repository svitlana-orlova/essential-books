<!doctype html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../../assets/main.css" rel="stylesheet">
</head>
<body class="page">
<header class="page__header">
    <div class="page__header__left">
        <a id="link-home" href="../../index.html">
            &nbsp;Essential Books</a>
    </div>
</header>
<div class="content">
    <div class="article">
      

<div style="display: flex; justify-content: space-between">
  <h1 class="title">A first window app</h1>
  <a class="edit-link" style="font-size: 80%" href="https://notion.so/e87631a7f8a94e8f92f9114e8e6baf0a" rel="nofollow" target="_blank">suggest change</a>
</div>


      
<p>Let's build a simple app that shows a list of files in a list view and has a search box for filtering results:
</p>
<p>Full source is <a href="https://github.com/essentialbooks/code/tree/master/go/windows">here</a> with the most relevant code in <a href="https://github.com/essentialbooks/code/blob/master/go/windows/file_manager.go">file_manager.go</a>.
</p>
<p>The app is the simplest file manager. It shows the files in the directory, allows navigating file system and limiting files shown to only those matching text entered in the edit control.
</p>
<div id="14363c23-2126-45d6-9707-c447517a19ff" class="column-list">
<div id="c484fe50-f7f4-4772-b6a8-65595d917ec9" style="width:50%" class="column">
<p>Showing all files in directory:
</p>
<img class="img" src="img/b469e98cf490663b4d39de1200599401529dac39.png.html">
</div>
<div id="4706353a-a7ae-4c59-8909-ece4493b6a1b" style="width:50%" class="column">
<p>Showing only files matching <code>go</code>:
</p>
<img class="img" src="img/08d891f443a484ec77d41acc996763d5952bd03b.png.html">
</div>
</div>
  <h1 id="5566d847-0fef-42af-856d-b87d8a0c9648" class="">Defining window layout
  <a class="header-anchor" href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#5566d847-0fef-42af-856d-b87d8a0c9648" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Let's define <code>FileManager</code> struct responsible for managing of the window:
</p>

<div class="code-box lang-Go">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="c1">// FileManager manages file manager window
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">FileManager</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">window</span>         <span class="o">*</span><span class="nx">walk</span><span class="p">.</span><span class="nx">MainWindow</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fileFilterEdit</span> <span class="o">*</span><span class="nx">walk</span><span class="p">.</span><span class="nx">LineEdit</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dirLabel</span>       <span class="o">*</span><span class="nx">walk</span><span class="p">.</span><span class="nx">Label</span>
</span></span><span class="line"><span class="cl">	<span class="nx">filesListBox</span>   <span class="o">*</span><span class="nx">walk</span><span class="p">.</span><span class="nx">ListBox</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ... more fields
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>The window consists of 3 widgets, arranged in a vertical list:
</p>
  <ul id="fd8b8bf8-4997-4036-961c-e28f4c8d8eae" class="bulleted-list">
    <li><code>LineEdit</code> for entering a filter that will limit what files are displayed in the files list
    </li>
    <li><code>Label</code> for showing current directory
    </li>
    <li><code>ListBox</code> for showing list of files and directories in a current directory
    </li>
  </ul>
<p>Walk has 2 layers:
</p>
  <ul id="a86ae253-e662-4d3e-b099-68548a11723a" class="bulleted-list">
    <li>widgets that are wrappers around win32 Windows controls e.g. <code>walk.LineEdit</code> is a wrapper around Windows <a href="https://docs.microsoft.com/en-us/windows/desktop/controls/edit-controls">edit control</a>.
    </li>
    <li>an optional declarative system for easily defining the layout of a Window
    </li>
  </ul>
<p>Here's a declarative layout of the above window:
</p>

<div class="code-box lang-Go">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">fm</span> <span class="nx">FileManager</span>
</span></span><span class="line"><span class="cl"><span class="nx">def</span> <span class="o">:=</span> <span class="nx">declarative</span><span class="p">.</span><span class="nx">MainWindow</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">AssignTo</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">fm</span><span class="p">.</span><span class="nx">window</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Title</span><span class="p">:</span>    <span class="s">"File Manageer"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MinSize</span><span class="p">:</span>  <span class="nx">declarative</span><span class="p">.</span><span class="nx">Size</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span> <span class="nx">Height</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Size</span><span class="p">:</span>     <span class="nx">declarative</span><span class="p">.</span><span class="nx">Size</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span> <span class="nx">Height</span><span class="p">:</span> <span class="mi">400</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Layout</span><span class="p">:</span>   <span class="nx">declarative</span><span class="p">.</span><span class="nx">VBox</span><span class="p">{},</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Children</span><span class="p">:</span> <span class="p">[]</span><span class="nx">declarative</span><span class="p">.</span><span class="nx">Widget</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">declarative</span><span class="p">.</span><span class="nx">LineEdit</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">AssignTo</span><span class="p">:</span>      <span class="o">&amp;</span><span class="nx">fm</span><span class="p">.</span><span class="nx">fileFilterEdit</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Visible</span><span class="p">:</span>       <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">CueBanner</span><span class="p">:</span>     <span class="s">"Enter file filter"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">OnTextChanged</span><span class="p">:</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">onFilterChanged</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">OnKeyUp</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">key</span> <span class="nx">walk</span><span class="p">.</span><span class="nx">Key</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">key</span> <span class="o">==</span> <span class="nx">walk</span><span class="p">.</span><span class="nx">KeyEscape</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">fm</span><span class="p">.</span><span class="nx">fileFilterEdit</span><span class="p">.</span><span class="nf">SetText</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">declarative</span><span class="p">.</span><span class="nx">Label</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">AssignTo</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">fm</span><span class="p">.</span><span class="nx">dirLabel</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Visible</span><span class="p">:</span>  <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Text</span><span class="p">:</span>     <span class="s">"Directory:"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">declarative</span><span class="p">.</span><span class="nx">ListBox</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">AssignTo</span><span class="p">:</span>        <span class="o">&amp;</span><span class="nx">fm</span><span class="p">.</span><span class="nx">filesListBox</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Visible</span><span class="p">:</span>         <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">OnItemActivated</span><span class="p">:</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">onFileClicked</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Each widget has a corresponding declarative definition e.g. <code>declarative.LineEdit</code> corresponds to <code>walk.LineEdit</code>.
</p>
<p>A <code>declarative.MainWindow</code> corresponds to top-level window.
</p>
<p>Some widgets, like <code>MainWindow</code> can have children (which are also widgets). For those widgets <code>Layout</code> specifies how children are arranged inside the parent. We use a <code>VBox</code> layout which arranges widgets in a vertical list.
</p>
  <h1 id="512b882c-184e-487a-a3ae-51898a5a8518" class="">Creating a window
  <a class="header-anchor" href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#512b882c-184e-487a-a3ae-51898a5a8518" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>To create window and its widgets we call:
</p>

<div class="code-box lang-Go">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="nx">err</span> <span class="o">:=</span> <span class="nx">def</span><span class="p">.</span><span class="nf">Create</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>This creates actual widgets based on declarative definition. During creation we can set initial properties on the widget and provide handlers for events generated by widgets.
</p>
<p><code>AssignTo</code> will set a given variable to a created widget, which allows us to manipulate the real widget in the future.
</p>
<p><code>Visible</code> allows to set the initial visibility state of the widget.
</p>
<p><code>Text</code> specifies initial text of <code>Label</code> widget.
</p>
<p><code>CueBanner</code> is a text displayed in <code>LineEdit</code> when its text is empty and the control doesn't have focus.
</p>
<p><code>OnTextChanged</code> is an event handler that will be called when text in <code>LineEdit</code> changes.
</p>
<p><code>OnItemActivated</code> is an event handler that will be called when user double-clicks on a list item.
</p>
  <h1 id="6bed5e72-f511-43e0-9a39-adc0a58510c2" class="">Running event loop
  <a class="header-anchor" href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#6bed5e72-f511-43e0-9a39-adc0a58510c2" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Windows GUI is event based. After we create a window, we need to run event loop which ensures processing of window messages:
</p>

<div class="code-box lang-Go">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="nx">_</span> <span class="p">=</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">window</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Event loop finishes when the user closes the window.
</p>
<p>Further execution of program logic happens as a result of responding to events generated by the user interacting with the widgets.
</p>
  <h1 id="d3b4b1db-9eb8-401c-b176-f2218bc6b3f7" class="">Thread-safe access to widget via synchronization
  <a class="header-anchor" href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#d3b4b1db-9eb8-401c-b176-f2218bc6b3f7" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>On Windows only the thread that created a given window / control can safely operate on this window / control. In most cases it's the main thread of the application, called UI thread.
</p>
<p>Walk inherits this limitation. Calling any method on a widget needs to be done on UI thread. If the code runs in a goroutine and manipulates widgets, it must be executed on the right thread. Use <code>widget.Synchronize(fn)</code> to schedule arbitrary function to  be executed on UI thread.
</p>
<p>Crashes are often a result of not observing that rule.
</p>
  <h1 id="3aef20e2-e640-4d47-bd8b-8f60f9e730e0" class="">Handling events
  <a class="header-anchor" href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#3aef20e2-e640-4d47-bd8b-8f60f9e730e0" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Some widgets broadcast events based on user interaction. We can provide functions to be called when an event happens.
</p>
<p><code>LineEdit</code> widget broadcasts <code>OnTextChanged</code> event when a text in edit widget changes. In our application we retrieve the text and use it to filter list of files to only show those that match the text:
</p>

<div class="code-box lang-Go">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">fm</span> <span class="o">*</span><span class="nx">FileManager</span><span class="p">)</span> <span class="nf">onFilterChanged</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">filter</span> <span class="o">:=</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">fileFilterEdit</span><span class="p">.</span><span class="nf">Text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fm</span><span class="p">.</span><span class="nf">applyFileFilter</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p><code>ListBox</code> widget broadcasts <code>OnItemActivated</code> event when a list item is activated e.g. with mouse double-click. We can retrieve the item selected with:
</p>

<div class="code-box lang-Go">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="nx">idx</span> <span class="o">:=</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">filesListBox</span><span class="p">.</span><span class="nf">CurrentIndex</span><span class="p">()</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>In our case we use it to navigate the directory hierarchy when user double-clicks a directory name.
</p>
  <h1 id="b85ea631-1592-43d5-a118-d8c35d9e2626" class="">Setting the content of a label
  <a class="header-anchor" href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#b85ea631-1592-43d5-a118-d8c35d9e2626" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>A <code>Label</code> is a simple widget that displays a line of text, which we can set with:
</p>

<div class="code-box lang-Go">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="nx">fm</span><span class="p">.</span><span class="nx">dirLabel</span><span class="p">.</span><span class="nf">SetText</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
  <h1 id="a312ad58-6125-463d-8bc4-36236b4b549a" class="">Setting the content of ListBox
  <a class="header-anchor" href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#a312ad58-6125-463d-8bc4-36236b4b549a" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Some widgets, like <code>ListBox</code> or <code>TreeView</code> show more complicated content like a list or tree of items.
</p>
<p>For <code>ListBox</code> the content is abstracted as <code>ListModel</code>. It's an interface that you implement to provide information about the list data.
</p>
<p>Walk handles simple cases for us. For example we can use a slice of strings <code>[]string{}</code> as a model:
</p>

<div class="code-box lang-Go">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="nx">model</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"item1"</span><span class="p">,</span> <span class="s">"item2"</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">listBox</span><span class="p">.</span><span class="nf">SetModel</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span></span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
  <h1 id="55278934-3af7-4064-9ff1-025d622c456a" class="">Application logic
  <a class="header-anchor" href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#55278934-3af7-4064-9ff1-025d622c456a" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>You can study the <a href="https://github.com/essentialbooks/code/blob/master/go/windows/file_manager.go">rest of the code</a> to see how to tie different pieces together.
</p>
<p>The high-level description is:
</p>
  <ul id="d74c0025-448e-4aff-b2bb-75f18f0f9ae6" class="bulleted-list">
    <li>we remember the name of the current directory in <code>FileManager.dir</code> and display it in <code>FileManager.dirLabel</code> widget of type <code>walk.Label</code>
    </li>
    <li>when user double-clicks name of directory in the <code>ListBox</code>, we get a list of files / directories in that directory on a goroutine (so that we don't block the UI). When that is finished we <code>Synchronize()</code> the code to update <code>ListBox</code> with list of of files
    </li>
    <li>when user changes a filter in <code>FileManager.fileFilterEdit</code> edit box, we limit displayed files to those that match the filter
    </li>
    <li>when user presses <code>Esc</code> when in <code>fileFilterEdit</code>, we clear the file filter. It's one of those little touches that make software more enjoyable for users.
    </li>
  </ul>
  <h1 id="ddb74856-cec0-4cba-8742-14c50b95dd1d" class="">Compiling as a windows application
  <a class="header-anchor" href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#ddb74856-cec0-4cba-8742-14c50b95dd1d" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Compiling the program as a valid Windows application is a bit more involved than a regular Go program.
</p>
<p>For modern Windows applications you need a manifest. You can re-use <a href="https://github.com/essentialbooks/code/blob/master/go/windows/app.manifest">this manifest</a> for most apps.
</p>
<p>In short it declares that the application is compatible with all Windows versions and that it opts in to modern look of controls by asking for version 6 of common controls library.
</p>
<p>A manifest must be embedded into an <code>.exe</code> as a resource.
</p>
<p>To achieve that:
</p>
  <ul id="02d25675-191d-4490-b7dc-6f818442cdb1" class="bulleted-list">
    <li>install <a href="https://github.com/akavel/rsrc">rsrc</a> tool by e.g. doing <code>go get -u </code><code><a href="https://github.com/akavel/rsrc">https://github.com/akavel/rsrc</a></code>, which should download the source code, build <code>rsrc.exe</code> and copy it <code>%GOPATH%\bin</code>, which should be in your <code>%PATH%</code>. If <code>go get</code> fails, you can download the code locally with <code>git clone </code><code><a href="https://github.com/akavel/rsrc.git">https://github.com/akavel/rsrc.git</a></code>, build with <code>go build</code> and copy <code>rsrc.exe</code> somewhere in the <code>%PATH%</code>.
    </li>
    <li>run <code>rsrc -manifest app.manifest -o rsrc.syso</code> to create <code>rsrc.syso</code> file that the go linker will embed as a resource
    </li>
    <li>run <code>go build -ldflags="-H windowsgui" -o app.exe .</code>
    </li>
  </ul>
<p>The argument <code>ldflags="-H windowsgui"</code> to <code>go build</code> passes <code>-H windowsgui</code> flag to the linker. 
</p>
<p>This flag marks executable as a Windows GUI application (as opposed to the default console application).
</p>
<p>If you don't embed the manifest in the application, it might fail to start in one of two ways:
</p>
  <ul id="73f194b5-02ed-425f-8511-a2992e0c4a36" class="bulleted-list">
    <li>If you compiled as a modern Windows app (i.e., with <code>-H windowsgui</code>), the app will fail silently.
    </li>
    <li>If you compiled as a non-Windows app (i.e., without <code>-H windowsgui</code>), you might get an error <code>TTM_ADDTOOL failed</code> printed to the console.
    </li>
  </ul>
<p>
</p>

      <div class="forum-link">
  Found a mistake? Have a question or improvement idea?
  <a href="a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a.html#" onclick="showContact(); return false;">Let me know</a>.
</div>

      <form id="contact-form" action="https://formsubmit.co/kkowalczyk@gmail.com" method="POST">
  <p>
    </p><div class="contact-light">Feedback about page:</div>
    <input type="text" name="page-url" id="contact-page-url" readonly>
  

  <p>
    </p><div class="contact-light">Feedback:</div>
    <textarea name="message" id="msg-for-chris"></textarea>
    <div class="contact-light">Optional: your email if you want me to get back to you: </div>
    <input type="email" name="email">
    <input type="hidden" name="_template" value="box">
    <input type="text" name="_honey" class="noshow">
  

  <p>
    <button type="submit" class="contact-btn">
      Send Feedback
    </button>

    <button class="contact-btn" style="float: right;" onclick="hideContact(); return false;">
      Cancel
    </button>
  </p>
</form>


      <hr class="article-bottom-sep">
    </div>

    <div id="page-toc"><div class="article chapter-toc svelte-1t851gm"><div class="mtoc-0 svelte-1t851gm"><b>Windows GUI programming:</b></div><div class="mtoc-1 svelte-1t851gm"><span class="no svelte-1ib47n1">*</span><b>A first window app</b></div></div></div>

    <div id="chapter-toc-wrapper">
      <hr>
      <div class="hdr">Table Of Contents</div>
      <div id="book-toc"><div class="article toc svelte-1ib47n1"><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">0</span><a href="getting-started-ba663c577a4a472e8c95fef8b4d8a8c6.html">Getting started</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">1</span><a href="basic-types-2803d5d5229f4932af82a1dcc86eb8bf.html">Basic types</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">2</span><a href="variables-5e911a698c43432dbf3ce33fc32dafe1.html">Variables</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">3</span><a href="constants-cb80712dca7545da8e0b20762c637409.html">Constants</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">4</span><a href="strings-ccc8d06958ae44319b21f9973716e3ca.html">Strings</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">5</span><a href="pointers-1ef07599dd8247f493ba6dcba8ae7dbf.html">Pointers</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">6</span><a href="arrays-58db8c9a56504deab2e61f1e0fa4a0a6.html">Arrays</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">7</span><a href="slices-f400553890d34185ba795870807c2615.html">Slices</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">8</span><a href="maps-80fb91dd63d445e28010b9f5e261da81.html">Maps</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">9</span><a href="structs-612802454798470ca5c5741d90543d22.html">Structs</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">10</span><a href="interfaces-4f5f2959e72c431e995527b51ad7fd8e.html">Interfaces</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">11</span><a href="empty-interface-c3315892508248fdb19b663bf8bff028.html">Empty interface</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">12</span><a href="if-switch-goto-fd755f13f0fc4e75ad9b9ee675e557e8.html">if, switch, goto</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">13</span><a href="for-while-loops-ad923a2fbd994701844af2d688d30548.html">for, while loops</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">14</span><a href="range-statement-c522a62872884110bcc300db67e0e9ad.html">range statement</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">15</span><a href="functions-6464727799a04611a891be7ca4877f8c.html">Functions</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">16</span><a href="methods-503ddd46a4854315a88973b8db780fba.html">Methods</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">17</span><a href="error-handling-39927eb13c11419492e67e9fd5328d8b.html">Error handling</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">18</span><a href="defer-20bfd8fa45454479954a6814eeeef716.html">Defer</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">19</span><a href="panic-and-recover-dda02e368b3048a5a69b81c56bfa6dbb.html">Panic and recover</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">20</span><a href="concurrency-16e8d8c3d77e44faaf6857a1df368ce8.html">Concurrency</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">21</span><a href="channels-and-select-4fac57c09168477aa12069484979f419.html">Channels and select</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">22</span><a href="mutex-41f795bf701d4784b3197349cdb8f2de.html">Mutex</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">23</span><a href="packages-6461fef8092a45158959bddbaad99bce.html">Packages</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">24</span><a href="files-and-io-7a55634fb8194a85bcc6036eeba61b39.html">Files and I/O</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">25</span><a href="time-and-date-c4da053493334df995134741ae04f808.html">Time and date</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">26</span><a href="command-line-arguments-05239fc069c3463dabc532b9d808612e.html">Command line arguments</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">27</span><a href="logging-f7fca2011c3748a19e3b8d66235cbe59.html">Logging</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">28</span><a href="executing-commands-c290f0566c80467a9005ab3a4024ec1d.html">Executing commands</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">29</span><a href="hex-base64-encoding-b6e9fbb3165c4bcb907e469d86783aab.html">Hex, base64 encoding</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">30</span><a href="json-1479bc5a08b64dbb8aa0e2f5ed17782f.html">JSON</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">31</span><a href="xml-6744c6d0d620448dbe66e224f64b6f8b.html">XML</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">32</span><a href="csv-abb984fec0d04d74b2d494ed3206d1bc.html">CSV</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">33</span><a href="yaml-29bafea8c8a546ab92284378bb7dc364.html">YAML</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">34</span><a href="sql-fc416b38f6f341bfa311bf6c575c73a1.html">SQL</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">35</span><a href="http-client-710edf91b0f146629abbfcd96aba4d80.html">HTTP Client</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">36</span><a href="http-server-96e6137284ae4460a2827f456b4cf62c.html">HTTP Server</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">37</span><a href="text-and-html-templates-cabbd74152a74e298be4afcd41ed10b2.html">Text and HTML templates</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">38</span><a href="reflection-c7fea6b176b74c54ab35f2d8fdd56f13.html">Reflection</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">39</span><a href="context-b58d13145f924c11afcf00aa10d71364.html">Context</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">40</span><a href="package-fmt-6ccd64ac7a174e1ea35366e014d9972a.html">Package fmt</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">41</span><a href="os-signals-48f2d17d3a7644daafbaf0ca9c8b61ad.html">OS Signals</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">42</span><a href="testing-b55ab9b1d6e5499ea3014ba7e85d3efd.html">Testing</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">43</span><a href="calling-c-from-go-with-cgo-d3b0419346904e0bbf6dc28b69fc93c6.html">Calling C from GO with cgo</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">44</span><a href="profiling-using-go-tool-pprof-83dc1f9b6ec04d25a2d2e7357b6bebba.html">Profiling using go tool pprof</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">45</span><a href="cross-compilation-41fdbdecca7b42c3b4b98e5ec0a96e13.html">Cross compilation</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">46</span><a href="conditional-compilation-with-build-tags-d1980344374d45c082c914c2aafa50cf.html">Conditional compilation with build tags</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">47</span><a href="inlining-functions-c2af72789a074a3aacf8d308f898f32c.html">Inlining functions</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">48</span><a href="sync.pool-for-better-performance-ec2352421ba7472ab82d9dcc71d2c389.html">sync.Pool for better performance</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">49</span><a href="gob-a09f2d8c9bba44e0acd0a9206e8f733f.html">gob</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">50</span><a href="plugin-9f2c4121df7e4b3f818131c49676387b.html">Plugin</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">51</span><a href="http-server-middleware-d8b9c9c2a49e4ba8a04cf7ff6ee2db0f.html">HTTP server middleware</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">52</span><a href="protobuf-in-go-b5c70cd2244f48a0b89aebc75ef45ad0.html">Protobuf in Go</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">53</span><a href="console-io-ddc28bcf51794ae5b021b8c0d9423497.html">Console I/O</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">54</span><a href="cryptography-301bb328156d420694ebf5489d2cb744.html">Cryptography</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">55</span><a href="images-png-jpeg-bmp-tiff-webp-vp8-gif-c84a45304ec3498081c67aa1ea0d9c49.html">Images (PNG, JPEG, BMP, TIFF, WEBP, VP8, GIF)</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">56</span><a href="the-go-command-f2028ab74a354cf2ba6a86acfb813356.html">The Go Command</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">57</span><a href="testing-code-with-ci-services-0ada5cfc7c4a4217af2e62d01df777de.html">Testing code with CI services</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">58</span><b>Windows GUI programming</b></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">59</span><a href="contributors-22efc95459e8462488d6608f1e963a74.html">Contributors</a></div></div></div></div>
    </div>
  </div></body>
</html>