<!doctype html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../../assets/main.css" rel="stylesheet">
</head>
<body class="page">
<header class="page__header">
    <div class="page__header__left">
        <a id="link-home" href="../../index.html">
            &nbsp;Essential Books</a>
    </div>
</header>
<div class="content">
    <div class="article">
      

<div style="display: flex; justify-content: space-between">
  <h1 class="title">Responsive canvas animations without resize events.</h1>
  <a class="edit-link" style="font-size: 80%" href="https://notion.so/4c2b00d9345b46c7b4314eefc6a32a9e" rel="nofollow" target="_blank">suggest change</a>
</div>


      
<p>The window resize events can fire in response to the movement of the userâ€™s input device. When you resize a canvas it is automatically cleared and you are forced to re-render the content. For animations you do this every frame via the main loop function called by <code>requestAnimationFrame</code> which does its best to keep the rendering in sync with the display hardware.
</p>
<p>The problem with the resize event is that when the mouse is used to resize the window the events can be trigger many times quicker than the standard 60fps rate of the browser. When the resize event exits the canvas back buffer is presented to the DOM out of sync with the display device, which can cause shearing and other negative effects. There is also a lot of needless memory allocation and release that can further impact the animation when GC cleans up some time afterwards.
</p>
<hr id="b26d9d00-47db-4874-a1a1-c2a2fdb89be3">
  <h2 id="15b687fa-b89f-46bb-9ed3-2f964d51ea42" class="">Debounced resize event
  <a class="header-anchor" href="responsive-canvas-animations-without-resize-events.-4c2b00d9345b46c7b4314eefc6a32a9e.html#15b687fa-b89f-46bb-9ed3-2f964d51ea42" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h2>
<p>A common way to deal with the high firing rates of the resize event is to debounce the resize event.
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">// Assume canvas is in scope
</span></span><span class="line"><span class="cl">addEventListener.("resize", debouncedResize );
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// debounce timeout handle
</span></span><span class="line"><span class="cl">var debounceTimeoutHandle;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// The debounce time in ms (1/1000th second)
</span></span><span class="line"><span class="cl">const DEBOUNCE_TIME = 100; 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Resize function 
</span></span><span class="line"><span class="cl">function debouncedResize () { 
</span></span><span class="line"><span class="cl">    clearTimeout(debounceTimeoutHandle);  // Clears any pending debounce events
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // Schedule a canvas resize 
</span></span><span class="line"><span class="cl">    debounceTimeoutHandle = setTimeout(resizeCanvas, DEBOUNCE_TIME);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// canvas resize function
</span></span><span class="line"><span class="cl">function resizeCanvas () { ... resize and redraw ... }</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>The above example delays the resizing of the canvas until 100ms after the resize event. If in that time further resize events are triggered the existing resize timeout is canceled and a new one scheduled. This effectively consumes most of the resize events.
</p>
<p>It still has some problems, the most notable is the delay between resizing and seeing the resized canvas. Reducing the debounce time improves this but the resize is still out of sync with the display device. You also still have the animation main loop rendering to an ill fitting canvas.
</p>
<p>More code can reduce the problems! More code also creates its own new problems.
</p>
<hr id="ed75281c-2bf9-4c8b-abd5-9c4da0f5ee7c">
  <h2 id="93819ced-de1c-438e-87c1-7f13cfdda914" class="">Simple and the best resize
  <a class="header-anchor" href="responsive-canvas-animations-without-resize-events.-4c2b00d9345b46c7b4314eefc6a32a9e.html#93819ced-de1c-438e-87c1-7f13cfdda914" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h2>
<p>Having tried many differing ways to smooth out the resizing of the canvas, from the absurdly complex, to just ignoring the problem (who cares anyways?) I fell back to a trusty friend.
</p>
<p><strong>K.I.S.S.</strong> is something most programmers should be aware of ((<strong>K</strong>eep <strong>I</strong>t <strong>S</strong>imple <strong>S</strong>tupid) <em>The stupid refers to me for not having thought of it years ago.</em> ) and it turns out the best solution is the simplest of all.
</p>
<p>Just resize the canvas from within the main animation loop. It stays in sync with the display device, there is no needless rendering, and the resource management is at the minimum possible while maintaining full frame rate. Nor do you need to add a resize event to the window or any additional resize functions.
</p>
<p>You add the resize where you would normally clear the canvas by checking if the canvas size matches the window size. If not resize it.
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">// Assumes canvas element is in scope as canvas
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Standard main loop function callback from requestAnimationFrame
</span></span><span class="line"><span class="cl">function mainLoop(time) {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // Check if the canvas size matches the window size
</span></span><span class="line"><span class="cl">    if (canvas.width !== innerWidth || canvas.height !== innerHeight) {
</span></span><span class="line"><span class="cl">        canvas.width = innerWidth;    // resize canvas
</span></span><span class="line"><span class="cl">        canvas.height = innerHeight;  // also clears the canvas
</span></span><span class="line"><span class="cl">    } else {
</span></span><span class="line"><span class="cl">        ctx.clearRect(0, 0, canvas.width, canvas.height); // clear if not resized
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // Animation code as normal.</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>

<div class="code-box lang-Plain Text">
	<div>
	<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">requestAnimationFrame(mainLoop);
</span></span><span class="line"><span class="cl">}</span></span></code></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>

      <div class="forum-link">
  Found a mistake? Have a question or improvement idea?
  <a href="responsive-canvas-animations-without-resize-events.-4c2b00d9345b46c7b4314eefc6a32a9e.html#" onclick="showContact(); return false;">Let me know</a>.
</div>

      <form id="contact-form" action="https://formsubmit.co/kkowalczyk@gmail.com" method="POST">
  <p>
    </p><div class="contact-light">Feedback about page:</div>
    <input type="text" name="page-url" id="contact-page-url" readonly>
  

  <p>
    </p><div class="contact-light">Feedback:</div>
    <textarea name="message" id="msg-for-chris"></textarea>
    <div class="contact-light">Optional: your email if you want me to get back to you: </div>
    <input type="email" name="email">
    <input type="hidden" name="_template" value="box">
    <input type="text" name="_honey" class="noshow">
  

  <p>
    <button type="submit" class="contact-btn">
      Send Feedback
    </button>

    <button class="contact-btn" style="float: right;" onclick="hideContact(); return false;">
      Cancel
    </button>
  </p>
</form>


      <hr class="article-bottom-sep">
    </div>

    <div id="page-toc"><div class="article chapter-toc svelte-1t851gm"><div class="mtoc-0 svelte-1t851gm"><b>Responsive design:</b></div><div class="mtoc-1 svelte-1t851gm"><span class="no svelte-1ib47n1">*</span><a href="responsive-design-8c1f9d788c6f471bba6da1b3d7768080.html">Responsive Design</a></div><div class="mtoc-1 svelte-1t851gm"><span class="no svelte-1ib47n1">*</span><a href="creating-a-responsive-full-page-canvas-b22ffa4f9aec40048c0e2692ee972335.html">Creating a responsive full page canvas</a></div><div class="mtoc-1 svelte-1t851gm"><span class="no svelte-1ib47n1">*</span><a href="mouse-coordinates-after-resizing-or-scrolling-8f5fd8af15dd4f8f8cf8399382546d8f.html">Mouse coordinates after resizing or scrolling</a></div><div class="mtoc-1 svelte-1t851gm"><span class="no svelte-1ib47n1">*</span><b>Responsive canvas animations without resize events.</b></div></div></div>

    <div id="chapter-toc-wrapper">
      <hr>
      <div class="hdr">Table Of Contents</div>
      <div id="book-toc"><div class="article toc svelte-1ib47n1"><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">0</span><a href="getting-started-7d650957f57448d485d0f1426726d652.html">Getting started</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">1</span><a href="images-ba65754ede34461eb1e1560e2d6309e4.html">Images</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">2</span><a href="path-syntax-db570444b7a84c65af507de125251743.html">Path syntax</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">3</span><a href="media-types-and-the-canvas-4ce6605a6537475291ee3480df7bacb9.html">Media types and the canvas</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">4</span><a href="animation-43473e4727d0430a914dcd63a767322a.html">Animation</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">5</span><a href="collisions-and-intersections-c37198bed8f348ef8bfc2cebe79b5d8b.html">Collisions and intersections</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">6</span><a href="paths-041fccaeeb964fce95770aaf8da6dad2.html">Paths</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">7</span><a href="text-0d20929db8564186bfedfbeecbb675d5.html">Text</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">8</span><a href="clearing-the-screen-28d114e4408844fc827c5f73d6238ff8.html">Clearing the screen</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">9</span><a href="navigating-along-a-path-69ada749d57144f89e7e47f98efde9a1.html">Navigating along a path</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">10</span><a href="dragging-path-shapes-images-dd776e0ee2284dd699b4439d20e57076.html">Dragging path shapes images</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">11</span><a href="shadows-15ffc1665db0493fb2645df513042ee7.html">Shadows</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">12</span><a href="charts-diagrams-55c84186869841c98d2d873c9b4a19c9.html">Charts diagrams</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">13</span><a href="polygons-e6a83a07a60745f6884992715cb6dc6b.html">Polygons</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">14</span><a href="transformations-90e27c4187894f0499f3a04940f3821a.html">Transformations</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">15</span><b>Responsive design</b></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">16</span><a href="compositing-de5b9aa74f444592b8f347684b3408b3.html">Compositing</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">17</span><a href="pixel-manipulation-ac5cc01d563d4c52a3602801411c5860.html">Pixel manipulation</a></div></div><div class="toc-item"><div class="chapters-toc-item"><span class="no svelte-1ib47n1">18</span><a href="contributors-bdca4d70e7e644fe95706e68527f05d6.html">Contributors</a></div></div></div></div>
    </div>
  </div></body>
</html>